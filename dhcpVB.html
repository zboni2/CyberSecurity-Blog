<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Secure Isolated Penetration Testing Lab with VirtualBox - Cybersecurity Blog</title>
</head>
<body>
    <header>
        <nav>
            <div class="nav-content">
                <h1>Cybersecurity Blog</h1>
                <div class="nav-links">
                    <a href="#" class="active">Home</a>
                    <a href="author.html">Writeups</a>
                    <a href="#">Tools</a>
                    <a href="#">About</a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <article class="writeup">
            <div class="writeup-header">
                <h2>Creating a Secure, Isolated Penetration Testing Lab in VirtualBox</h2>
                <div class="metadata">
                    <span class="author"><a href="author.html">Written by Altin Hajdini</a></span>
                    <div class="metadata-details">
                        <span class="date">June 15, 2025</span>
                        <span class="difficulty">Difficulty: Beginner</span>
                    </div>
                </div>
            </div>

            <div class="intro-section">
                <h3>About This Guide</h3>
                <p>Welcome to this guide on creating a completely isolated penetration testing lab using Oracle VM VirtualBox on Windows 11. This setup is specifically designed for security enthusiasts who want to practice ethical hacking in a safe, controlled environment without any external network access.</p>
                
                <div class="security-note">
                    <h4>Why an Isolated Lab?</h4>
                    <p>When practicing penetration testing with vulnerable VMs from platforms like TryHackMe or VulnHub, connecting to public networks can expose you to risks from other participants. This guide shows you how to create a private, isolated network where you can safely practice without any external interference.</p>
                </div>
                
                <h4>Key Benefits</h4>
                <ul>
                    <li><strong>Complete Isolation</strong>: No internet access means no risk of external interference</li>
                    <li><strong>Full Control</strong>: You control all aspects of the network environment</li>
                    <li><strong>Safe Learning</strong>: Practice techniques without affecting real systems</li>
                    <li><strong>Offline Access</strong>: Work on your lab without needing an internet connection</li>
                </ul>
                
                <div class="vm-info">
                    <p><strong>Prerequisites:</strong></p>
                    <ul>
                        <li>Windows 11 Host Machine</li>
                        <li>Oracle VM VirtualBox 7.0 or later</li>
                        <li>Kali Linux ISO (for your attacking machine)</li>
                        <li>Vulnerable VM images (e.g., from VulnHub)</li>
                        <li>At least 8GB RAM (16GB recommended)</li>
                        <li>50GB+ free disk space</li>
                    </ul>
                </div>
            </div>

            <div class="toc">
                <h3>Table of Contents</h3>
                <ol>
                    <li><a href="#setup">Lab Architecture Overview</a></li>
                    <li><a href="#network-setup">Creating the Isolated Network</a>
                        <ol>
                            <li><a href="#create-internal-network">Setting Up Internal Network in VirtualBox</a></li>
                            <li><a href="#configure-vms">Configuring VMs for the Isolated Network</a></li>
                        </ol>
                    </li>
                    <li><a href="#kali-setup">Setting Up Kali Linux</a>
                        <ol>
                            <li><a href="#kali-install">Installation</a></li>
                            <li><a href="#kali-config">Network Configuration</a></li>
                        </ol>
                    </li>
                    <li><a href="#target-vms">Adding Vulnerable Target VMs</a>
                        <ol>
                            <li><a href="#importing-vms">Importing from VulnHub</a></li>
                            <li><a href="#network-settings">Network Settings for Target VMs</a></li>
                        </ol>
                    </li>
                    <li><a href="#verification">Verifying the Setup</a></li>
                    <li><a href="#best-practices">Security Best Practices</a></li>
                </ol>
            </div>

            <div class="tools-list">
                <h3>Lab Components</h3>
                <ul>
                    <li><code>Kali Linux</code> <span class="tool-desc">Your primary attacking machine with all necessary tools pre-installed</span></li>
                    <li><code>Vulnerable VMs</code> <span class="tool-desc">Pre-built virtual machines from VulnHub for practice</span></li>
                    <li><code>VirtualBox Internal Network</code> <span class="tool-desc">Completely isolated network for secure testing</span></li>
                    <li><code>VirtualBox Host-Only Adapter</code> <span class="tool-desc">For host-to-guest communication when needed</span></li>
                </ul>
                
                <div class="security-note">
                    <h4>Important Security Note</h4>
                    <p>While this setup is isolated, always ensure you have proper authorization before performing security testing, even in your own lab. Some techniques may be illegal if used against systems you don't own or have explicit permission to test.</p>
                </div>
            </div>

            <section id="setup" class="content-section">
                <h3>1. Initial Setup</h3>
                
                <h4 id="create-vm">1.1 Creating a New Virtual Machine</h4>
                <p>Let's start by creating a new virtual machine in VirtualBox:</p>
                <ol>
                    <li>Open VirtualBox and click <strong>New</strong></li>
                    <li>Name your VM (e.g., "DHCP-Server")</li>
                    <li>Select <strong>Linux</strong> as the type and <strong>Ubuntu (64-bit)</strong> as the version</li>
                    <li>Allocate at least 1GB of RAM (2GB recommended)</li>
                    <li>Create a virtual hard disk (20GB should be sufficient)</li>
                </ol>

                <h4 id="network-config">1.2 Network Configuration</h4>
                <p>Before starting the VM, we need to configure the network settings:</p>
                <ol>
                    <li>Select your VM and click <strong>Settings</strong></li>
                    <li>Go to <strong>Network</strong></li>
                    <li>For <strong>Adapter 1</strong>:
                        <ul>
                            <li>Check <strong>Enable Network Adapter</strong></li>
                            <li>Attached to: <strong>Internal Network</strong></li>
                            <li>Name: <strong>intnet</strong> (or any name you prefer)</li>
                        </ul>
                    </li>
                    <li>For <strong>Adapter 2</strong>:
                        <ul>
                            <li>Check <strong>Enable Network Adapter</strong></li>
                            <li>Attached to: <strong>NAT</strong> (for internet access)</li>
                        </ul>
                    </li>
                </ol>

                <h4 id="os-installation">1.3 Ubuntu Server Installation</h4>
                <p>Now, let's install Ubuntu Server:</p>
                <ol>
                    <li>Start the VM and select your Ubuntu Server ISO</li>
                    <li>Follow the installation wizard with these specifications:
                        <ul>
                            <li>Language: <strong>English</strong></li>
                            <li>Keyboard: <strong>Your preferred layout</strong></li>
                            <li>Network: <strong>Configure both interfaces with DHCP for now</strong></li>
                            <li>Storage: <strong>Use entire disk (LVM)</strong></li>
                            <li>Profile: <strong>Set up your user account</strong></li>
                            <li>SSH Server: <strong>Install OpenSSH server</strong></li>
                            <li>Additional software: <strong>Standard system utilities</strong></li>
                        </ul>
                    </li>
                    <li>Complete the installation and reboot the system</li>
                </ol>
            </section>

            <section id="dhcp-installation" class="content-section">
                <h3>2. DHCP Server Installation</h3>
                <p>After the system reboots, log in and update your package lists:</p>
                <div class="code-block">
                    <pre><code>sudo apt update
sudo apt upgrade -y</code></pre>
                </div>
                
                <p>Now, install the ISC DHCP server:</p>
                <div class="code-block">
                    <pre><code>sudo apt install isc-dhcp-server -y</code></pre>
                </div>
                
                <p>Verify the installation:</p>
                <div class="code-block">
                    <pre><code>dhcpd --version</code></pre>
                </div>
            </section>

            <section id="dhcp-configuration" class="content-section">
                <h3>3. DHCP Configuration</h3>
                <p>Now, let's configure the DHCP server. First, identify your network interface:</p>
                <div class="code-block">
                    <pre><code>ip a</code></pre>
                </div>
                
                <p>Look for the interface connected to your internal network (it might be <code>enp0s3</code> or similar). Then edit the DHCP server configuration:</p>
                <div class="code-block">
                    <pre><code>sudo nano /etc/default/isc-dhcp-server</code></pre>
                </div>
                
                <p>Update the <code>INTERFACESv4</code> line to include your internal network interface (e.g., <code>enp0s3</code>).</p>
                
                <p>Next, configure the DHCP server settings:</p>
                <div class="code-block">
                    <pre><code>sudo nano /etc/dhcp/dhcpd.conf</code></pre>
                </div>
                
                <p>Add the following configuration (adjust the IP range and other settings as needed):</p>
                <div class="code-block">
                    <pre><code># Basic configuration
ddns-update-style none;
default-lease-time 600;
max-lease-time 7200;

# Subnet configuration
subnet 192.168.56.0 netmask 255.255.255.0 {
    range 192.168.56.100 192.168.56.200;
    option routers 192.168.56.1;
    option domain-name-servers 8.8.8.8, 8.8.4.4;
    option domain-name "homelab.local";
}</code></pre>
                </div>
                
                <p>Save the file and restart the DHCP server:</p>
                <div class="code-block">
                    <pre><code>sudo systemctl restart isc-dhcp-server
sudo systemctl enable isc-dhcp-server</code></pre>
                </div>
            </section>

            <section id="testing" class="content-section">
                <h3>4. Testing and Verification</h3>
                <p>To test if your DHCP server is working:</p>
                
                <ol>
                    <li>Create another VM in VirtualBox and connect it to the same internal network</li>
                    <li>Set the network adapter to use DHCP</li>
                    <li>Start the VM and check if it receives an IP address in the configured range</li>
                </ol>
                
                <p>On your DHCP server, check the lease file to see assigned IPs:</p>
                <div class="code-block">
                    <pre><code>sudo cat /var/lib/dhcp/dhcpd.leases</code></pre>
                </div>
            </section>

            <section id="troubleshooting" class="content-section">
                <h3>5. Troubleshooting</h3>
                
                <h4>Common Issues and Solutions</h4>
                
                <div class="troubleshooting-tip">
                    <h5>DHCP Server Not Starting</h5>
                    <p>If the DHCP service fails to start, check the logs:</p>
                    <div class="code-block">
                        <pre><code>sudo journalctl -u isc-dhcp-server.service -f</code></pre>
                    </div>
                </div>
                
                <div class="troubleshooting-tip">
                    <h5>Clients Not Getting IP Addresses</h5>
                    <p>Verify that:</p>
                    <ul>
                        <li>The DHCP server is running: <code>sudo systemctl status isc-dhcp-server</code></li>
                        <li>The correct interface is specified in <code>/etc/default/isc-dhcp-server</code></li>
                        <li>The subnet in <code>dhcpd.conf</code> matches your network configuration</li>
                    </ul>
                </div>
                
                <div class="troubleshooting-tip">
                    <h5>Firewall Blocking DHCP</h5>
                    <p>If you have UFW enabled, allow DHCP traffic:</p>
                    <div class="code-block">
                        <pre><code>sudo ufw allow 67/udp
sudo ufw allow 68/udp</code></pre>
                    </div>
                </div>
            </section>

            <div class="conclusion">
                <h3>Conclusion</h3>
                <p>Congratulations! You've successfully set up a DHCP server in your VirtualBox homelab environment. This setup provides a solid foundation for more advanced networking experiments and services. You can now add more VMs to your internal network, and they'll automatically receive IP addresses from your DHCP server.</p>
                
                <p>For more advanced configurations, consider exploring:</p>
                <ul>
                    <li>Setting up static IP reservations for specific MAC addresses</li>
                    <li>Configuring DNS and DHCP together with BIND and ISC DHCP</li>
                    <li>Implementing DHCP relay agents for more complex network topologies</li>
                </ul>
                
                <p>Happy networking! 🚀</p>
            </div>
        </article>
    </main>

    <footer>
        <p>&copy; 2025 Cybersecurity Blog</p>
    </footer>

    <!-- Modal for expanded images -->
    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="expandedImage">
        <div id="caption"></div>
    </div>

    <script>
        // Get modal
        var modal = document.getElementById('imageModal');
        
        // Get image and insert it inside the modal
        var modalImg = document.getElementById("expandedImage");
        var captionText = document.getElementById("caption");
        
        // Get all images with class 'screenshot-img' and add click event
        var images = document.querySelectorAll('.screenshot img');
        images.forEach(function(img) {
            img.onclick = function(){
                modal.style.display = "block";
                modalImg.src = this.src;
                captionText.innerHTML = this.alt;
            }
        });
        
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        
        // When the user clicks on <span> (x), close the modal
        span.onclick = function() { 
            modal.style.display = "none";
        }
        
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>
